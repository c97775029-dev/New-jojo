<!DOCTYPE html>
<html>
<head>
    <title>Coco Jumbo: Time Architect</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: monospace; touch-action: none; -webkit-user-select: none; }
        #menu, #charMenu, #retry { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); background: rgba(0,0,0,0.95); padding: 20px; border: 4px solid gold; text-align: center; color: #fff; z-index: 99; width: 300px; border-radius: 15px; }
        #ui { position: absolute; top: 10px; width: 100%; text-align: center; color: #fff; display: none; pointer-events: none; }
        .bar-bg { width: 120px; height: 12px; border: 2px solid #fff; background: #333; margin: 5px auto; }
        #pBar, #eBar { width: 100%; height: 100%; transition: 0.1s; }
        #pBar { background: #00ff00; } #eBar { background: #ff0000; }
        #ctrl { position: absolute; bottom: 30px; width: 100%; text-align: center; display: none; }
        button { padding: 12px; font-size: 14px; font-weight: bold; border-radius: 8px; border: none; cursor: pointer; margin: 5px; width: 120px; }
        .ts-active { filter: invert(1) hue-rotate(180deg); }
    </style>
</head>
<body>
    <div id="menu">
        <h2 style="color:gold">DIFFICULTY</h2>
        <button style="background:#0f0" onclick="setDiff('easy')">EASY</button>
        <button style="background:#fa0" onclick="setDiff('med')">MEDIUM</button>
        <button style="background:#f00; color:#fff" onclick="setDiff('hard')">HARD</button>
    </div>
    <div id="charMenu" style="display:none">
        <h2 style="color:gold">SELECT STAND</h2>
        <button style="background:#0066ff;color:#fff" onclick="start('jotaro')">JOTARO</button>
        <button style="background:#228b22;color:#fff" onclick="start('coco')">COCO JUMBO (ADMIN)</button>
    </div>
    <div id="ui">
        <div style="display:flex;justify-content:space-around">
            <div id="pName">PLAYER</div><div class="bar-bg"><div id="pBar"></div></div>
            <div>DIO</div><div class="bar-bg"><div id="eBar"></div></div>
        </div>
        <p id="msg" style="color:gold">FIGHT!</p>
    </div>
    <div id="retry" style="display:none"><h2 id="st"></h2><button onclick="location.reload()">RETRY</button></div>
    <div id="ctrl">
        <button id="atkBtn" style="background:#00ff00">ATTACK</button>
        <button id="tsBtn" style="display:none; background:gold">STOP TIME</button>
        <button id="knfBtn" style="display:none; background:silver">THROW KNIFE</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        const s = new THREE.Scene(), c = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000), r = new THREE.WebGLRenderer({antialias:true});
        r.setSize(window.innerWidth, window.innerHeight); document.body.appendChild(r.domElement);
        s.add(new THREE.AmbientLight(0xffffff, 1.0)); c.position.z = 5;
        const p = new THREE.Mesh(new THREE.BoxGeometry(1, 2, 1), new THREE.MeshStandardMaterial({color: 0x0066ff})); p.position.x = -2; s.add(p);
        const e = new THREE.Mesh(new THREE.BoxGeometry(1, 2, 1), new THREE.MeshStandardMaterial({color: 0xff0000})); e.position.x = 2; s.add(e);
        
        let php=100, maxPHP=100, ehp=100, gOver=false, isTS=false, isAdmin=false, diff='';
        let activeKnives = [];

        function setDiff(m) { diff=m; document.getElementById('menu').style.display='none'; document.getElementById('charMenu').style.display='block'; }

        function start(char) {
            if(char=='coco'){
                isAdmin=true; php=1000000; maxPHP=1000000; p.material.color.set(0x228b22);
                p.scale.set(0.8, 0.4, 0.8); p.position.y = -0.8;
                document.getElementById('tsBtn').style.display = 'inline-block';
                document.getElementById('knfBtn').style.display = 'inline-block';
            }
            document.getElementById('charMenu').style.display='none';
            document.getElementById('ui').style.display=document.getElementById('ctrl').style.display='block';
            if(!isAdmin) setInterval(dioAtk, 1500);
        }

        document.getElementById('atkBtn').onclick = () => {
            if(gOver) return;
            ehp -= isAdmin ? 100 : 5; upd();
            p.position.x = -1; setTimeout(()=>p.position.x=-2, 50);
        };

        document.getElementById('tsBtn').onclick = () => {
            isTS = !isTS;
            document.body.classList.toggle('ts-active', isTS);
            document.getElementById('tsBtn').innerText = isTS ? "RESUME TIME" : "STOP TIME";
        };

        document.getElementById('knfBtn').onclick = () => {
            const knf = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.1, 0.1), new THREE.MeshStandardMaterial({color: 0xcccccc}));
            knf.position.set(p.position.x + 0.5, p.position.y + 0.5, 0);
            s.add(knf);
            
            let knfObj = { mesh: knf, launched: !isTS };
            if (isTS) {
                // Move forward slightly then stop
                knf.position.x += 0.8;
            }
            activeKnives.push(knfObj);
        };

        function dioAtk() { if(!isTS && !gOver) { e.position.x=0; php-=5; upd(); setTimeout(()=>e.position.x=2, 100); }}

        function upd() {
            document.getElementById('pBar').style.width=(php/maxPHP*100)+'%';
            document.getElementById('eBar').style.width=Math.max(0,ehp)+'%';
            if(ehp<=0){ gOver=true; document.getElementById('retry').style.display='block'; document.getElementById('st').innerText="DIO DEFEATED"; }
        }

        function animate() {
            requestAnimationFrame(animate);
            activeKnives.forEach((kObj, index) => {
                if (!isTS || kObj.launched) {
                    kObj.mesh.position.x += 0.2;
                    if (kObj.mesh.position.x > 1.8 && kObj.mesh.position.x < 2.2) {
                        ehp -= isAdmin ? 50 : 10; upd();
                        s.remove(kObj.mesh);
                        activeKnives.splice(index, 1);
                    }
                    if(kObj.mesh.position.x > 10) { s.remove(kObj.mesh); activeKnives.splice(index, 1); }
                }
            });
            r.render(s, c);
        }
        animate();
    </script>
</body>
</html>
